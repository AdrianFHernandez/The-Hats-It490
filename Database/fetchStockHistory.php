<?php require_once "../config/database.php"; // Include your DB connection file require_once "../functions/stock_functions.php"; // Include stock fetching functions // Get database connection $db = getDatabaseConnection(); // Fetch all stocks that users hold $query = "SELECT DISTINCT stock_symbol FROM Portfolio"; $result = $db->query($query); if (!$result) { die("Error fetching portfolio stocks: " . $db->error); } $stocks = []; while ($row = $result->fetch_assoc()) { $stocks[] = $row['stock_symbol']; } // Fetch and insert stock history foreach ($stocks as $stock) { echo "Fetching history for: $stock\n"; $history = fetchStockHistory($stock); // Assume this function exists and returns an array if (!$history) { echo "No history found for $stock\n"; continue; } // Insert stock history into database $stmt = $db->prepare("INSERT INTO StockHistory (stock_symbol, date, open_price, close_price, high, low, volume) VALUES (?, ?, ?, ?, ?, ?, ?)"); foreach ($history as $data) { $stmt->bind_param("ssddddd", $stock, $data['date'], $data['open'], $data['close'], $data['high'], $data['low'], $data['volume']); $stmt->execute(); } echo "Inserted history for $stock\n"; } $stmt->close(); $db->close(); echo "Stock history update complete.\n"; 
